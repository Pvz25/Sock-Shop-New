# Fix OpenMetrics Port - Use Correct Exporter Port 9419
# Previous attempt used 9090, but exporter actually runs on 9419

spec:
  template:
    metadata:
      annotations:
        ad.datadoghq.com/rabbitmq-exporter.check_names: '["openmetrics"]'
        ad.datadoghq.com/rabbitmq-exporter.init_configs: '[{}]'
        ad.datadoghq.com/rabbitmq-exporter.instances: |
          [
            {
              "openmetrics_endpoint": "http://%%host%%:9419/metrics",
              "namespace": "rabbitmq",
              "metrics": [".*"],
              "send_distribution_buckets": true,
              "send_distribution_counts_as_monotonic": true,
              "send_distribution_sums_as_monotonic": true,
              "tags": [
                "app:sock-shop",
                "component:rabbitmq",
                "service:rabbitmq",
                "env:demo",
                "integration:rabbitmq-exporter"
              ]
            }
          ]
        ad.datadoghq.com/rabbitmq.logs: '[{"source": "rabbitmq", "service": "sock-shop-rabbitmq"}]'
        ad.datadoghq.com/rabbitmq-exporter.logs: '[{"source": "rabbitmq_exporter", "service": "sock-shop-rabbitmq-exporter"}]'
